<?php

namespace Database\Migrations;

use Doctrine\Migrations\AbstractMigration;
use Doctrine\DBAL\Schema\Schema as Schema;

class Version00000000000045 extends AbstractMigration
{
    /**
     * @param Schema $schema
     */
    public function up(Schema $schema): void
    {
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != 'mysql', 'Migration can only be executed safely on \'mysql\'.');

        $this->addSql('CREATE TABLE aftersales_offline_refund (id BIGINT AUTO_INCREMENT NOT NULL COMMENT \'自增ID\', refund_bn BIGINT NOT NULL COMMENT \'申请退款单号\', order_id BIGINT NOT NULL COMMENT \'订单号\', company_id BIGINT NOT NULL COMMENT \'公司id\', refund_fee INT UNSIGNED NOT NULL COMMENT \'应退金额，以分为单位，非积分支付\', bank_account_name VARCHAR(50) NOT NULL COMMENT \'收款账户名称\', bank_account_no VARCHAR(30) NOT NULL COMMENT \'收款银行账号\', bank_name VARCHAR(100) NOT NULL COMMENT \'收款开户银行\', refund_account_name VARCHAR(100) DEFAULT \'\' COMMENT \'退款账户名\', refund_account_bank VARCHAR(100) DEFAULT \'\' COMMENT \'退款银行\', refund_account_no VARCHAR(100) DEFAULT \'\' COMMENT \'退款账号\', create_time INT NOT NULL COMMENT \'创建时间\', update_time INT DEFAULT NULL COMMENT \'更新时间\', INDEX idx_refund_bn (refund_bn), INDEX idx_order_id (order_id), INDEX idx_company_id (company_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'线下转账退款\' ');
        $this->addSql('CREATE TABLE selfservice_registration_activity_rel_shop (id BIGINT AUTO_INCREMENT NOT NULL, activity_id BIGINT NOT NULL COMMENT \'报名活动ID\', distributor_id BIGINT NOT NULL COMMENT \'店铺ID\', created INT NOT NULL, updated INT DEFAULT NULL, INDEX idx_activity_id (activity_id), INDEX idx_distributor_id (distributor_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'报名活动关联店铺\' ');
        $this->addSql('CREATE TABLE supplier_goods (item_id BIGINT AUTO_INCREMENT NOT NULL COMMENT \'供应商商品id\', item_type VARCHAR(15) DEFAULT \'services\' NOT NULL COMMENT \'商品类型，services：服务商品，normal: 普通商品\', item_category VARCHAR(15) DEFAULT \'null\' COMMENT \'商品主类目\', item_name VARCHAR(255) NOT NULL COMMENT \'商品名称\', item_bn VARCHAR(255) NOT NULL COMMENT \'商品编号\', barcode VARCHAR(50) DEFAULT \'\' NOT NULL COMMENT \'商品条形码\', brief VARCHAR(255) NOT NULL COMMENT \'简洁的描述\', company_id BIGINT NOT NULL COMMENT \'公司ID\', price INT NOT NULL COMMENT \'销售价,单位为‘分’\', cost_price INT DEFAULT 0 COMMENT \'成本价,单位为‘分’\', item_unit VARCHAR(255) DEFAULT NULL COMMENT \'商品计量单位\', special_type VARCHAR(255) DEFAULT \'normal\' COMMENT \'商品特殊类型 drug 处方药 normal 普通商品\', item_address_province VARCHAR(255) DEFAULT NULL COMMENT \'产地省\', item_address_city VARCHAR(255) DEFAULT NULL COMMENT \'产地市\', regions_id VARCHAR(255) DEFAULT NULL COMMENT \'产地地区id\', regions LONGTEXT DEFAULT NULL COMMENT \'产地地区\', store INT DEFAULT NULL COMMENT \'库存\', sales INT DEFAULT 0 COMMENT \'销量\', market_price INT NOT NULL COMMENT \'原价,单位为‘分’\', goods_function VARCHAR(255) DEFAULT NULL COMMENT \'商品功能\', goods_series VARCHAR(255) DEFAULT NULL COMMENT \'商品系列\', goods_color VARCHAR(255) DEFAULT NULL COMMENT \'商品颜色\', goods_brand VARCHAR(255) DEFAULT NULL COMMENT \'商品品牌\', is_default TINYINT(1) DEFAULT \'1\' COMMENT \'商品是否为默认商品\', default_item_id BIGINT DEFAULT 0 COMMENT \'默认商品ID\', goods_id BIGINT DEFAULT 0 COMMENT \'产品ID\', nospec VARCHAR(255) DEFAULT \'true\' COMMENT \'商品是否为单规格\', weight DOUBLE PRECISION DEFAULT \'0\' COMMENT \'商品重量\', sort INT DEFAULT 0 NOT NULL COMMENT \'商品排序\', templates_id INT DEFAULT NULL COMMENT \'运费模板id\', pics JSON NOT NULL COMMENT \'图片(DC2Type:json_array)\', pics_create_qrcode JSON DEFAULT NULL COMMENT \'图片是否生成小程序码(DC2Type:json_array)\', video_type VARCHAR(255) DEFAULT \'local\' NOT NULL COMMENT \'视频类型 local:本地视频 tencent:腾讯视频\', videos LONGTEXT DEFAULT NULL COMMENT \'视频\', video_pic_url LONGTEXT DEFAULT NULL COMMENT \'视频封面图\', intro LONGTEXT DEFAULT NULL COMMENT \'图文详情\', purchase_agreement LONGTEXT DEFAULT NULL COMMENT \'购买协议\', is_show_specimg TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'详情页是否显示规格图片\', enable_agreement TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'开启购买协议\', date_type VARCHAR(255) DEFAULT NULL COMMENT \'有效期的类型, DATE_TYPE_FIX_TIME_RANGE:指定日期范围内, DATE_TYPE_FIX_TERM:固定天数后\', begin_date INT DEFAULT NULL COMMENT \'有效期开始时间\', end_date INT DEFAULT NULL COMMENT \'有效期结束时间\', fixed_term INT DEFAULT NULL COMMENT \'有效期的有效天数\', brand_logo VARCHAR(1024) DEFAULT NULL COMMENT \'品牌图片\', volume DOUBLE PRECISION DEFAULT NULL COMMENT \'商品体积\', item_source VARCHAR(255) DEFAULT \'mall\' NOT NULL COMMENT \'商品来源:mall:主商城;distributor:店铺自有;openapi:开放接口;\', brand_id INT DEFAULT 0 COMMENT \'品牌id\', tax_rate INT NOT NULL COMMENT \'税率, 百分之～/100\', crossborder_tax_rate VARCHAR(10) NOT NULL COMMENT \'跨境税率，百分比，小数点2位\', profit_type INT DEFAULT 0 COMMENT \'分润类型, 默认为0配置分润,1主类目分润,2商品指定分润(比例),3商品指定分润(金额)\', origincountry_id BIGINT DEFAULT 0 NOT NULL COMMENT \'产地国id\', taxstrategy_id BIGINT DEFAULT 0 NOT NULL COMMENT \'税费策略id\', taxation_num INT DEFAULT 0 NOT NULL COMMENT \'计税单位份数\', profit_fee INT DEFAULT 0 COMMENT \'分润金额,单位为分 冗余字段\', type INT DEFAULT 0 NOT NULL COMMENT \'商品类型，0普通，1跨境商品，可扩展\', is_gift TINYINT(1) DEFAULT \'0\' COMMENT \'是否为赠品\', is_package TINYINT(1) DEFAULT \'0\' COMMENT \'是否为打包产品\', tdk_content LONGTEXT DEFAULT NULL COMMENT \'tdk详情\', supplier_id INT DEFAULT 0 NOT NULL COMMENT \'供应商id\', is_market INT DEFAULT 1 NOT NULL COMMENT \'供应商控制商品是否可售，0不可售，1可售\', goods_bn VARCHAR(255) DEFAULT NULL COMMENT \'SPU编码\', audit_date INT DEFAULT NULL COMMENT \'商品审核时间\', audit_status VARCHAR(255) DEFAULT \'approved\' COMMENT \'审核状态 submiting待提交 approved成功 processing审核中 rejected审核拒绝\', audit_reason LONGTEXT DEFAULT NULL COMMENT \'审核拒绝原因\', created INT NOT NULL, updated INT DEFAULT NULL, INDEX ix_company_id (company_id), INDEX ix_default_item_id (default_item_id), INDEX ix_item_category (item_category), INDEX ix_item_bn (item_bn), INDEX ix_supplier_id (supplier_id), INDEX ix_goods_id (goods_id), INDEX ix_is_default (is_default), INDEX ix_default_item_list (company_id, default_item_id, item_type, item_category), PRIMARY KEY(item_id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'新供应商商品表\' ');
        $this->addSql('CREATE TABLE supplier_goods_attr (id BIGINT AUTO_INCREMENT NOT NULL COMMENT \'ID\', company_id BIGINT NOT NULL COMMENT \'公司ID\', item_id BIGINT NOT NULL COMMENT \'商品ID\', attribute_id BIGINT DEFAULT 0 NOT NULL COMMENT \'商品属性id\', is_del BIGINT DEFAULT 0 NOT NULL COMMENT \'是否需要删除\', attribute_type VARCHAR(15) NOT NULL COMMENT \'商品属性类型 unit 单位，brand 品牌，item_params 商品参数, item_spec 规格, category 商品销售分类\', attr_data LONGTEXT DEFAULT NULL COMMENT \'属性值\', created INT NOT NULL, updated INT DEFAULT NULL, INDEX ix_item_id (item_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB COMMENT = \'新供应商商品属性表\' ');
        $this->addSql('ALTER TABLE employee_purchase_activities ADD distributor_id INT DEFAULT 0 NOT NULL COMMENT \'店铺id,为0时表示商城的企业\', ADD operator_id INT DEFAULT 0 NOT NULL COMMENT \'操作id\', ADD price_display_config JSON DEFAULT NULL COMMENT \'价格展示配置(DC2Type:json_array)\', ADD is_discount_description_enabled TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'优惠说明开关\', ADD discount_description VARCHAR(50) DEFAULT \'\' NOT NULL COMMENT \'优惠说明\'');
        $this->addSql('CREATE INDEX idx_distributor_id ON employee_purchase_activities (distributor_id)');
        $this->addSql('ALTER TABLE employee_purchase_cart ADD shop_type VARCHAR(255) DEFAULT \'distributor\' COMMENT \'店铺类型；distributor:店铺，shop:门店，community:社区, mall:商城, drug 药品清单\', ADD shop_id BIGINT UNSIGNED DEFAULT 0 COMMENT \'店铺id 或者 社区id\'');
        $this->addSql('ALTER TABLE employee_purchase_employees ADD distributor_id INT DEFAULT 0 NOT NULL COMMENT \'店铺id,为0时表示为商城的员工\', ADD operator_id INT DEFAULT 0 NOT NULL COMMENT \'操作id\'');
        $this->addSql('CREATE INDEX idx_distributor_id ON employee_purchase_employees (distributor_id)');
        $this->addSql('CREATE INDEX idx_enterprise_userid ON employee_purchase_employees (enterprise_id, user_id)');
        $this->addSql('ALTER TABLE employee_purchase_enterprise_email_box ADD suffix VARCHAR(50) NOT NULL COMMENT \'员工收件邮箱后缀\'');
        $this->addSql('ALTER TABLE employee_purchase_enterprises ADD distributor_id INT DEFAULT 0 NOT NULL COMMENT \'店铺id,为0时表示商城的企业\', ADD operator_id INT DEFAULT 0 NOT NULL COMMENT \'操作id\', ADD qr_code_bg_image LONGTEXT DEFAULT NULL COMMENT \'二维码背景图\', ADD is_employee_check_enabled TINYINT(1) DEFAULT \'0\' NOT NULL COMMENT \'是否验证员工白名单\', CHANGE auth_type auth_type VARCHAR(20) NOT NULL COMMENT \'登录类型,mobile:手机号,account:账号,email:邮箱,qr_code:二维码\'');
        $this->addSql('CREATE INDEX idx_distributor_id ON employee_purchase_enterprises (distributor_id)');
        $this->addSql('ALTER TABLE employee_purchase_relatives ADD distributor_id INT DEFAULT 0 NOT NULL COMMENT \'店铺id,为0时表示为商城的员工\', CHANGE created created bigint NOT NULL');
        $this->addSql('CREATE INDEX idx_distributor_id ON employee_purchase_relatives (distributor_id)');
        $this->addSql('CREATE INDEX idx_enterprise_userid_actid ON employee_purchase_relatives (enterprise_id, user_id, activity_id)');
        $this->addSql('ALTER TABLE items ADD supplier_item_id INT DEFAULT 0 NOT NULL COMMENT \'供应商商品id\'');
        $this->addSql('CREATE INDEX ix_supplier_item_id ON items (supplier_item_id)');
        $this->addSql('ALTER TABLE point_member_log CHANGE journal_type journal_type SMALLINT NOT NULL COMMENT \'积分交易类型，1:注册送积分 2.推荐送分 3.充值返积分 4.推广注册返积分 5.积分换购 6.储值兑换积分 7.订单返积分 8.会员等级返佣 9.取消订处理积分 10.售后处理积分 11.大转盘抽奖送积分 12:管理员手动调整积分 13.外部开发者同步进来的会员积分 14:会员信息导入，初始化积分 15:会员信息导入，更新会员调整积分; 16 活动报名送积分\'');
        $this->addSql('ALTER TABLE selfservice_form_setting ADD distributor_id BIGINT DEFAULT 0 NOT NULL COMMENT \'店铺id\', ADD pic_name VARCHAR(50) DEFAULT NULL COMMENT \'图片描述\'');
        $this->addSql('ALTER TABLE selfservice_form_template ADD distributor_id BIGINT DEFAULT 0 NOT NULL COMMENT \'店铺id\', ADD header_bg_pic VARCHAR(300) DEFAULT NULL COMMENT \'头部背景图片\', ADD header_height VARCHAR(20) DEFAULT NULL COMMENT \'头部留白高度(px)\'');
        $this->addSql('ALTER TABLE selfservice_registration_activity ADD distributor_id BIGINT DEFAULT 0 NOT NULL COMMENT \'店铺id\', ADD area VARCHAR(100) DEFAULT NULL COMMENT \'活动城市(省市)\', ADD place VARCHAR(100) DEFAULT NULL COMMENT \'活动地点\', ADD address VARCHAR(200) DEFAULT NULL COMMENT \'详情地址\', ADD intro VARCHAR(500) DEFAULT NULL COMMENT \'活动简介\', ADD show_fields VARCHAR(100) DEFAULT NULL COMMENT \'前端展示字段\', ADD pics TEXT, ADD gift_points INT NOT NULL COMMENT \'奖励积分\', ADD is_allow_duplicate INT NOT NULL COMMENT \'是否允许重复报名(1或0)\', ADD is_allow_cancel INT NOT NULL COMMENT \'是否允许取消报名(1或0)\', ADD is_offline_verify INT NOT NULL COMMENT \'是否线下核销(1或0)\', ADD is_need_check INT NOT NULL COMMENT \'是否需要审核(1或0)\', ADD is_white_list INT NOT NULL COMMENT \'是否自动加入内购白名单(1或0)\', ADD enterprise_ids LONGTEXT DEFAULT NULL COMMENT \'内购白名单企业ID\', ADD group_no VARCHAR(15) DEFAULT \'\' COMMENT \'活动分组编码\', ADD member_level VARCHAR(50) DEFAULT NULL COMMENT \'适用会员等级\', ADD distributor_ids VARCHAR(100) DEFAULT \'\' COMMENT \'适用店铺\', ADD join_tips VARCHAR(200) DEFAULT NULL COMMENT \'活动参与提示信息\', ADD submit_form_tips LONGTEXT DEFAULT NULL COMMENT \'表单填写提示信息\', ADD content LONGTEXT DEFAULT NULL COMMENT \'图文详情\', CHANGE activity_name activity_name VARCHAR(200) NOT NULL COMMENT \'活动名称\'');
        $this->addSql('CREATE INDEX idx_group_no ON selfservice_registration_activity (group_no)');
        $this->addSql('ALTER TABLE selfservice_registration_record ADD distributor_id BIGINT DEFAULT 0 NOT NULL COMMENT \'店铺id\', ADD record_no BIGINT DEFAULT 0 NOT NULL COMMENT \'报名编号\', ADD group_no VARCHAR(15) DEFAULT \'\' COMMENT \'活动分组编码\', ADD form_id BIGINT NOT NULL COMMENT \'表单id\', ADD get_points BIGINT NOT NULL COMMENT \'获取到积分\', ADD verify_code BIGINT NOT NULL COMMENT \'核销码\', ADD verify_time BIGINT DEFAULT 0 NOT NULL COMMENT \'核销时间\', ADD verify_operator VARCHAR(50) DEFAULT \'\' COMMENT \'核销员\', ADD true_name VARCHAR(30) DEFAULT \'\' COMMENT \'真实姓名\', ADD is_white_list BIGINT NOT NULL COMMENT \'是否加入白名单\', ADD form_mobile VARCHAR(255) DEFAULT \'\' NOT NULL COMMENT \'表单填写手机号\', CHANGE status status VARCHAR(32) DEFAULT \'pending\' NOT NULL COMMENT \'状态: pending 待审核，passed 已通过，rejected 已拒绝, canceled 已取消, verified 已核销\'');
        $this->addSql('CREATE INDEX idx_true_name ON selfservice_registration_record (true_name)');
        $this->addSql('CREATE INDEX idx_created ON selfservice_registration_record (created)');
        $this->addSql('CREATE INDEX idx_status ON selfservice_registration_record (status)');
    }

    /**
     * @param Schema $schema
     */
    public function down(Schema $schema): void
    {
    }
}
